!function n(i,o,s){function a(t,e){if(!o[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=o[t]={exports:{}},i[t][0].call(r.exports,function(e){return a(i[t][1][e]||e)},r,r.exports,n,i,o,s)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=class{constructor(e){var t=document.querySelector(e);if(!t)throw new Error("DOM elements not found, id="+e);this._textAreaElement=t,this._textAreaElement.value="",this._lines=[],this._maxLines=30}log(...e){0!=e.length&&(e=Array.prototype.slice.call(e).join(" "),console.log(e),this._pushText(e))}error(...e){0!=e.length&&(e=Array.prototype.slice.call(e).join(" "),console.error(e),this._pushText("[ERR] - "+e))}_pushText(e){this._lines.push(e),this._lines.length>this._maxLines&&this._lines.splice(0,this._lines.length-this._maxLines),this._textAreaElement.value=this._lines.join("\n")+`
`,this._textAreaElement.scrollTop=this._textAreaElement.scrollHeight}get size(){return this._lines.length}peekLast(){if(0<this._lines.length)return this._lines[this._lines.length-1]}popLast(){0<this._lines.length&&this._lines.splice(this._lines.length-1,1)}}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.checkMultithreadingSupport=void 0,r.checkMultithreadingSupport=()=>{var e=void 0!==window.SharedArrayBuffer;if(e)if(!(new WebAssembly.Memory({initial:8,maximum:8,shared:!0}).buffer instanceof SharedArrayBuffer))return!1;return e}},{}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ensureWasmSupport=void 0,r.ensureWasmSupport=(e,t)=>{if(!(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1})())throw t(t="missing WebAssembly feature (unsuported)"),new Error(t);e.log("[JS] WebAssembly feature => supported")}},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractVarsFromUrl=void 0;const n=/[?&]+([^=&]+)=([^&]*)/gi;r.extractVarsFromUrl=()=>{for(var e={};r=n.exec(window.location.href);){var t=r[1],r=r[2];e[t]=r}return e}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getWebGl2Context=void 0,r.getWebGl2Context=(e,t,r)=>{e.addEventListener("webglcontextcreationerror",()=>{r("Could not create a WebGL2 context.")},!1),e.addEventListener("webglcontextlost",()=>{r("WebGL2 context lost. You will need to reload the page.")},!1);if(e.addEventListener("contextmenu",e=>{e.preventDefault()},!1),!window.WebGL2RenderingContext)throw r("Missing WebGL2 feature (unsuported)"),new Error("missing WebGL2 feature (unsuported)");t.log("[JS] WebGL2 feature => supported");e=e.getContext("webgl2",{alpha:!1,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!1});if(e)return t.log("[JS] WebGL2 context => initialised"),e;throw r(t="WebGL2 context failed (initialisation)"),new Error(t)}},{}],6:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./extractVarsFromUrl"),r),i(e("./ensureWasmSupport"),r),i(e("./checkMultithreadingSupport"),r),i(e("./scriptLoadingUtility"),r),i(e("./getWebGl2Context"),r)},{"./checkMultithreadingSupport":2,"./ensureWasmSupport":3,"./extractVarsFromUrl":4,"./getWebGl2Context":5,"./scriptLoadingUtility":7}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scriptLoadingUtility=void 0,r.scriptLoadingUtility=n=>new Promise((e,t)=>{var r=document.createElement("script");r.src=n,r.addEventListener("load",()=>e),r.addEventListener("error",t),document.head.appendChild(r)})},{}],8:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,s,a,l){return new(a=a||Promise)(function(r,t){function n(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,i)}o((l=l.apply(e,s||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});const w=e("./Logger"),m=e("./helpers");window.addEventListener("load",()=>n(void 0,void 0,void 0,function*(){const r=new w.default("#loggerOutput");r.log("[JS] page loaded");var e=e=>{r.error("[JS] exception, event="+e)};window.addEventListener("error",e);const t=document.querySelector("#errorText"),n=document.querySelector("#renderArea"),i=document.querySelector("#emscriptenCanvas");var o={try_with_90_cars:document.querySelector("#try_with_90_cars"),try_with_270_cars:document.querySelector("#try_with_270_cars")};const s=e=>{"none"!==e.style.display&&(e.style.display="none")},a=e=>{"block"!==e.style.display&&(e.style.display="block")},l=e=>{t.innerHTML=e,s(i),a(t)};var c,u=(e,t)=>e?parseInt(e,10):t,d=m.extractVarsFromUrl(),u={width:u(d.width,800),height:u(d.height,600),totalCores:u(d.totalCores,3),genomesPerCore:u(d.genomesPerCore,30)},d=(d=u.width,c=u.height,n.style.width=d+"px",n.style.height=c+"px",i.width=d,i.height=c,i.style.width=d+"px",i.style.height=c+"px",(e,t,r)=>{e.disabled=!1,e.classList.contains(t)||e.classList.add(t),e.classList.contains("grayButton")&&e.classList.remove("grayButton"),e.addEventListener("click",()=>{window.location.href=window.location.pathname+"?genomesPerCore="+r})});30!=u.genomesPerCore?(o.try_with_270_cars.disabled=!0,d(o.try_with_90_cars,"blueButton",30)):(o.try_with_90_cars.disabled=!0,d(o.try_with_270_cars,"redButton",90));let p;try{if(!window.Worker)throw new Error("missing WebWorker feature");r.log("[JS] WebWorker feature => supported"),m.ensureWasmSupport(r,e=>{r.error("[JS] "+e),l(`
          this browser isn't compatible<br>
          error message:<br>
          => ${e}
        `)}),p=m.getWebGl2Context(i,r,e=>{r.error("[JS] "+e),l(`
          this browser isn't compatible<br>
          error message:<br>
          => ${e}
        `)})}catch(e){r.error(`[JS] dependencies check failed: message="${e.message}"`)}let h="wasm";m.checkMultithreadingSupport()?(r.log("[JS] multithreading => supported"),h+="/pthread"):(r.log("[JS] multithreading => unsupported, fallback to webworker version"),h+="/webworker");const g={downloadingDataRegExp:/Downloading data\.\.\. \(([0-9]*)\/([0-9]*)\)/,lastProgressLevel:0,locateFile:e=>h+"/"+e,print:e=>{r.log("[C++] "+e)},printErr:e=>{r.error("[C++] "+e)},setStatus:e=>{var t;e&&((t=g.downloadingDataRegExp.exec(e))?(0<r.size&&g.downloadingDataRegExp.test(r.peekLast())&&r.popLast(),t=parseFloat(t[1])/parseFloat(t[2])*100,g.lastProgressLevel!==t&&(t=`${e} [${(g.lastProgressLevel=t).toFixed(0)}%]`,r.log("[JS] "+t),l(t))):r.log("[JS] "+e))},onRuntimeInitialized:()=>{s(t),a(i)},canvas:i,preinitializedWebGLContext:p,noExitRuntime:!0,arguments:[""+u.width,""+u.height,""+u.totalCores,""+u.genomesPerCore]},f=(window.Module=g,e=>{window.removeEventListener("error",f),r.error("[JS] exception, event="+e.message),g.setStatus=e=>{e&&r.error("[JS, post-exception] "+e)},l("Error<br>message:<br>"+e.message)});window.removeEventListener("error",e),window.addEventListener("error",f),g.setStatus("Downloading...");try{yield m.scriptLoadingUtility(`./${h}/index.js`),r.log("[JS] wasm script: loading successful")}catch(e){r.error("[JS] wasm script: loading failed"),l("Error<br>wasm script: loading failed.")}}))},{"./Logger":1,"./helpers":6}]},{},[8]);